<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>CNC åŠ å·¥æ•¸é‡æŸ¥è©¢</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="config.js"></script>
    <link rel="stylesheet" href="å…±ç”¨é¢¨æ ¼.css">

    <style>
        body {
            background-image: linear-gradient(120deg, #f6d365 0%, #fda085 100%);
        }
        .input-group-text {
            color: rgb(11, 148, 4);
        }

        .btn-è— {
            width:100%;
            font-size:20px;
            padding:5px;
            height: 40px;
            font-weight: bold;
        }

        .btn-è— {
            width:100%;
            font-size:20px;
            padding:5px;
            height: 40px;
            font-weight: bold;
        }

        .btn-ç´« {
            width:100%;
            font-size:20px;
            padding:5px;
            height: 40px;
            font-weight: bold;
        }

        /* ğŸ§® æœ€å¾Œä¸€åˆ—ï¼ˆç¸½è¨ˆåˆ—ï¼‰æ¨£å¼ */
        #result tr:last-child td {
            font-weight: bold;         /* å­—é«”åŠ ç²— */
            background-color: #ffe345; /* é¡¯çœ¼çš„é»ƒåº• */
            font-size:16px;
        }

    </style>
</head>

<body>
  <!-- å°è¦½åˆ— -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="é¦–é .html">
        <img src="https://kuanlin1218.github.io/CNC_QS/CNC%E5%8A%A0%E5%B7%A5%E6%95%B8%E9%87%8F%E7%B5%B1%E8%A8%88_ver_2/logo_S.png" alt="Logo" class="navbar-logo">
        è©®æ ©CNCé›²ç«¯ç³»çµ±
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="åˆ‡æ›å°è¦½åˆ—">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="é¦–é .html">ğŸ  é¦–é </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="åˆ€å…·å…¥åº«.html">ğŸ› ï¸ åˆ€å…·å…¥åº«</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="åˆ€å…·æŸ¥è©¢.html">ğŸ” åˆ€å…·æŸ¥è©¢</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="åŠ å·¥æ•¸é‡ç™»è¨˜.html">âœï¸ åŠ å·¥æ•¸é‡ç™»è¨˜</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="åŠ å·¥æ•¸é‡æŸ¥è©¢.html">ğŸ“Š åŠ å·¥æ•¸é‡æŸ¥è©¢</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

    <div class="container">
        <form id="myForm2" onsubmit="searchValues(event)">
            <h2 class="text-center">ğŸ“Š åŠ å·¥æ•¸é‡æŸ¥è©¢ ğŸ“Š</h2><hr>
            <div class="input-group my-3">
                <span class="input-group-text">é–‹å§‹æ—¥æœŸ</span>
                <input type="date" id="dt1" class="form-control custom" required>
            </div>
            <div class="input-group my-3">
                <span class="input-group-text">çµæŸæ—¥æœŸ</span>
                <input type="date" id="dt2" class="form-control custom" required>
            </div>
            <div class="input-group my-3">
                <span class="input-group-text">ç”¢å“ç·¨è™Ÿ</span>
                <select id="pd2" class="form-select custom" required></select>
            </div>
            <button type="submit" class="btn btn-è—">æ—¥æœŸå€é–“æŸ¥è©¢</button>
            <button type="button" class="btn btn-ç´« mt-2" onclick="searchlastValues(event)">æŸ¥è©¢æœ€å¾Œä¸€ç­†</button>
        </form>
        <hr>
        <!-- é¡¯ç¤ºè¡¨æ ¼å…§å®¹ -->
        <div class="table-container" id="result"></div>
        <br>
    </div>

    <script>

        window.onload = function () {
            setYesterdayDate('dt1');
            setYesterdayDate('dt2');
            loadProductList(); // ç”¨ fetch è¼‰å…¥ç”¢å“ç·¨è™Ÿ
        };

        // è¨­å®šé è¨­æ—¥æœŸç‚ºæ˜¨å¤©
        function setYesterdayDate(inputId) {
            const date = new Date();
            date.setDate(date.getDate() - 1);
            const yyyy = date.getFullYear();
            const mm = String(date.getMonth() + 1).padStart(2, '0');
            const dd = String(date.getDate()).padStart(2, '0');
            document.getElementById(inputId).value = `${yyyy}-${mm}-${dd}`;
        }

        // è¼‰å…¥ç”¢å“æ¸…å–®
        function loadProductList() {
            fetch(`${scriptUrl}?page=production_entry&type=product`)
            .then(res => res.json())
            .then(data => {
                const pdSelect = document.getElementById("pd2");
                pdSelect.innerHTML = '<option value=""></option>';
                data.forEach(item => {
                    pdSelect.appendChild(new Option(item, item));
                });
            })
            .catch(err => console.error("è¼‰å…¥ç”¢å“å¤±æ•—", err));
        }

        function searchValues(event) {
            event.preventDefault();
            const dt1 = document.getElementById("dt1").value;
            const dt2 = document.getElementById("dt2").value;
            const pd = document.getElementById("pd2").value;
            if (!pd) return alert("è«‹é¸æ“‡ç”¢å“ç·¨è™Ÿ");

            const d1 = new Date(dt1);
            const d2 = new Date(dt2);
            const f1 = `${d1.getFullYear()}/${d1.getMonth() + 1}/${d1.getDate()}`;
            const f2 = `${d2.getFullYear()}/${d2.getMonth() + 1}/${d2.getDate()}`;

            fetch(`${scriptUrl}?page=production_query&pd=${encodeURIComponent(pd)}&dt1=${f1}&dt2=${f2}`)
            .then(res => res.json())
            .then(rows => {
                displayTable(rows);
            })
            .catch(() => alert("æŸ¥è©¢å¤±æ•—"));
        }

        function searchlastValues(event) {
            event.preventDefault();
            const pd = document.getElementById("pd2").value;
            if (!pd) return alert("è«‹é¸æ“‡ç”¢å“ç·¨è™Ÿ");

            fetch(`${scriptUrl}?page=production_query&mode=latest&pd=${encodeURIComponent(pd)}`)
            .then(res => res.json())
            .then(data => {
                displayTable(data);
            })
            .catch(() => alert("æŸ¥è©¢å¤±æ•—"));
        }

        function displayTable(data, emptyMessage = "æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„è³‡æ–™") {
            const resultDiv = document.getElementById("result");

            if (!data || data.length === 0) {
                resultDiv.innerHTML = `<p>${emptyMessage}</p>`;
                return;
            }

            const headers = ["æ—¥æœŸ", "ç”¢å“ç·¨è™Ÿ", "æ•¸é‡"];
            let html = `<table class="table table-bordered table-striped"><thead><tr>`;
            headers.forEach(h => {
                html += `<th>${h}</th>`;
            });
            html += `</tr></thead><tbody>`;

            let total = 0;
            data.forEach(row => {
                html += `<tr>`;
                row.forEach((cell, i) => {
                html += `<td>${cell}</td>`;
                if (i === 2) total += parseInt(cell) || 0;
                });
                html += `</tr>`;
            });

            html += `<tr><td colspan="2">ç¸½æ•¸é‡</td><td>${total}</td></tr>`;
            html += `</tbody></table>`;
            resultDiv.innerHTML = html;
        }

        document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
            link.addEventListener('click', () => {
                const navbar = document.getElementById('navbarNav');
                if (navbar.classList.contains('show')) navbar.classList.remove('show');
            });
        });

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    window.scrollTo({ top: target.offsetTop - 50, behavior: 'smooth' });
                }
            });
        });
    </script>
</body>
</html>
